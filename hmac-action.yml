name: Generate OKX HMAC Signature

on:
  repository_dispatch:
    types: [generate-signature]

jobs:
  generate-signature:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Setup Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.12'

      - name: Run HMAC Script
        id: signature
        env:
          PREHASH: ${{ github.event.client_payload.prehash }}
          SECRET_KEY: ${{ secrets.OKX_SECRET_KEY }}
        run: |
          python hmac_signer.py

      - name: Output Signature
        run: echo "sign=$(cat signature.txt)" >> $GITHUB_OUTPUT

      - name: Send Response Webhook (Opcional para Make)
        if: env.MAKE_WEBHOOK_URL
        run: |
          curl -X POST ${{ secrets.MAKE_WEBHOOK_URL }} \
          -H "Content-Type: application/json" \
          -d "{\"sign\": \"$(cat signature.txt)\"}"
